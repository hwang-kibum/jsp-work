#!/bin/bash
O="OK"
N="WARNNING"
function liner(){
	for i in {1..50..1};
	do
		echo -n "#"
	done
	echo ""
}

function clear_line() {
	liner
	for i in {1..50..1};
	do
		echo " "
	done
	echo ""
}

function jump() {
	printf "\n\n" >> ${FILE}
}

function result(){ 
	echo -n "result : " >> ${FILE}
}
FILE="./miso_report.txt"
CONF=""
touch ${FILE}
#########################################################################
G01="1. Account Manager."
U01="U-01 - 'root' account remote access restrictions. : "
R01=`cat /etc/ssh/sshd_config | grep ^PermitRootLogin`

echo ${G01} > ${FILE}
liner >> ${FILE}
liner >> ${FILE}
echo -n ${U01} >> ${FILE}
echo ${R01} >> ${FILE}

result 

CONF=`cat ${FILE} | awk '{print $9}'`
if [ ${CONF} = "no" ]; then
	echo "${O}" >> ${FILE}
else
	echo "${N}" >> ${FILE}
fi

jump

###########################################################################
U02="U-02 - password complexity setting. : "
R02=`tail -9 /etc/security/pwquality.conf`
MINLEN="minlen"
DCREDIT="dcredit"
UCREDIT="ucredit"
LCREDIT="lcredit"
OCREDIT="ocredit"
MINCLASS="minclass"
MAXREPEAT="maxrepeat"
MAXCLASSREPEAT="maxclassrepeat"


for i in ${R02};
do 
	PARS_NAME=`echo ${i} | awk '{print $1}'`
	echo ${PARS_NAME}
	PARS_NUM=`echo ${i} | awk '{print $5}'`
	echo ${PARS_NUM}
	case ${PARS_NAME} in
		${MINLEN})
		       if [ ${PARS_NUM} -gt 8 ];then
	       			echo "$MINLEN config : $PARS_NUM " >> $FILE
				echo "$U02 $PAR_NAME : $PARS_NUM : ${O}" >> $FILE
			else
	       			echo "$MINLEN config : $PARS_NUM " >> $FILE
				echo "$U02 $PAR_NAME : $PARS_NUM : ${N}" >> $FILE
			fi	
			;;
		${DCREDIT})
			echo "" >> $FILE
		       if [ ${PARS_NUM} -lt 0 ];then
	       			echo "$MINLEN config : $PARS_NUM " >> $FILE
				echo "$U02 $PAR_NAME : $PARS_NUM : ${O}" >> $FILE
			else
	       			echo "$MINLEN config : $PARS_NUM " >> $FILE
				echo "$U02 $PAR_NAME : $PARS_NUM : ${N}" >> $FILE
			fi
			;;
		${UCREDIT})
			echo "새로운 패스워드 설정시 최대 대문자 개수" >> $FILE
		       if [ ${PARS_NUM} -lt 0 ];then
	       			echo "$MINLEN config : $PARS_NUM " >> $FILE
				echo "$U02 $PAR_NAME : $PARS_NUM : ${O}" >> $FILE
			else
	       			echo "$MINLEN config : $PARS_NUM " >> $FILE
				echo "$U02 $PAR_NAME : $PARS_NUM : ${N}" >> $FILE
			fi
			;;
		${LCREDIT})
			echo "새로운 패스워드 설정시 최대 소문자 개수" >> $FILE
		       if [ ${PARS_NUM} -gt 0 ];then
	       			echo "$MINLEN config : $PARS_NUM " >> $FILE
				echo "$U02 $PAR_NAME : $PARS_NUM : ${O}" >> $FILE
			else
	       			echo "$MINLEN config : $PARS_NUM " >> $FILE
				echo "$U02 $PAR_NAME : $PARS_NUM : ${N}" >> $FILE
			fi
			;;
		${OCREDIT})
			echo "새로운 패스워드 설정시 최대 특수 문자 개수 요구" >> $FILE
		       if [ ${PARS_NUM} -gt 0 ];then
	       			echo "$MINLEN config : $PARS_NUM " >> $FILE
				echo "$U02 $PAR_NAME : $PARS_NUM : ${O}" >> $FILE
			else
	       			echo "$MINLEN config : $PARS_NUM " >> $FILE
				echo "$U02 $PAR_NAME : $PARS_NUM : ${N}" >> $FILE
			fi
			;;
		${MINCLASS})
			echo "새로운 패스워드 설정시 (숫자, 대문자, 소문자, 기타) 최소 종류" >> $FILE
		       if [ $PARS_NUM -gt 0 ];then
	       			echo "$MINLEN config : $PARS_NUM " >> $FILE
				echo "$U02 $PAR_NAME : $PARS_NUM : ${O}" >> $FILE
			else
	       			echo "$MINLEN config : $PARS_NUM " >> $FILE
				echo "$U02 $PAR_NAME : $PARS_NUM : ${N}" >> $FILE
			fi
			;;
		${MAXREPEAT})
			echo "새로운 패스워드 설정시연달아 나오는 같은 문자 최대 개수" >> $FILE
 			if [ $PARS_NUM -gt 1 ];then
	       			echo "$MINLEN config : $PARS_NUM " >> $FILE
				echo "$U02 $PAR_NAME : $PARS_NUM : ${O}" >> $FILE
			else
	       			echo "$MINLEN config : $PARS_NUM " >> $FILE
				echo "$U02 $PAR_NAME : $PARS_NUM : ${N}" >> $FILE
			fi
			;;
		${MAXCLASSREPEAT})
			echo "새로운 패스워드 설정시 연달아 나오는 같은 종류의 문자최대개수" >> $FILE
		       if [ $PARS_NUM -gt 1 ];then
	       			echo "$MINLEN config : $PARS_NUM " >> $FILE
				echo "$U02 $PAR_NAME : $PARS_NUM : ${O}" >> $FILE
			else
	       			echo "$MINLEN config : $PARS_NUM " >> $FILE
				echo "$U02 $PAR_NAME : $PARS_NUM : ${N}" >> $FILE
			fi
			;;
		${DIFORK})
			echo "이전 패스워드오 비교하여 새로운 패스워드에만 있는 문자 개수" >> $FILE
		       if [ $PARS_NUM -gt 4 ];then
	       			echo "$MINLEN config : $PARS_NUM " >> $FILE
				echo "$U02 $PAR_NAME : $PARS_NUM : ${O}" >> $FILE
			else
	       			echo "$MINLEN config : $PARS_NUM " >> $FILE
				echo "$U02 $PAR_NAME : $PARS_NUM : ${N}" >> $FILE
			fi
			;;

	esac
done

